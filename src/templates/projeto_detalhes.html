{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h2>Detalhes do Projeto: {{ projeto.nome }}</h2>
    
    <div class="card mt-3">
        <div class="card-body">
            <h4>Descrição Atual:</h4>
            <p>{{ projeto.descricao }}</p>
            <a href="{{ url_for('crisp.editar_descricao', tipo='projeto', id=projeto.id) }}" class="btn btn-primary">✏️</a>
        </div>
    </div>

    <div class="mt-4">
        <h4>📜 Histórico de Alterações:</h4>
        <ul class="list-group">
            {% for item in projeto.historico %}
			
            <li class="list-group-item">
                <strong>Data:</strong> {{ item.data_modificacao.strftime('%d/%m/%Y %H:%M') }} <br>
                <strong>Descrição Anterior:</strong> {{ item.descricao_anterior }}
            </li>
            {% else %}
            <p>Nenhuma alteração registrada.</p>
            {% endfor %}
        </ul>
    </div>

    <div class="mt-4">
        <h3>📌 Fases do Projeto</h3>
        {% for fase in projeto.fases %}
        <div class="card mt-3">
            <div class="card-body">
                <h4>{{ fase.nome }}</h4>
                <p><strong>Descrição:</strong> {{ fase.descricao }}</p>
        

                <a href="{{ url_for('crisp.editar_descricao', tipo='fase', id=fase.id) }}" class="btn btn-primary btn-sm">✏️ Editar Descrição</a>

                <h5 class="mt-3">📌 Atividades:</h5>
                <ul class="list-group">
                    {% for atividade in fase.atividades %}
                    <li class="list-group-item">
                        <strong>{{ atividade.nome }}</strong> <br>
                        <small><strong>Descrição:</strong> {{ atividade.descricao }}</small> <br>
                        <small><strong>Data de Criação:</strong> {{ atividade.criado_em.strftime('%d/%m/%Y') }}</small>
                        <a href="{{ url_for('crisp.editar_descricao', tipo='atividade', id=atividade.id) }}" class="btn btn-primary btn-sm mt-1">✏️ Editar</a>
                    </li>
                    {% else %}
                    <p>Não há atividades nesta fase.</p>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% else %}
        <p>Nenhuma fase cadastrada.</p>
        {% endfor %}
    </div>

    <div class="mt-4">
        <h3>📄 Exportar Registros</h3>
        <a href="{{ url_for('crisp.gerar_pdf') }}" class="btn btn-danger">📥 Baixar PDF</a>
        <a href="{{ url_for('crisp.gerar_md') }}" class="btn btn-secondary">📥 Baixar Markdown</a>
    </div>
</div>
{% endblock %}
